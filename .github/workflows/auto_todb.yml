name: Update Weather Data to Firestore
on:
   schedule:
     - cron: '0 13 * * *'  # รันทุกๆ 6 ชั่วโมง
   workflow_dispatch:  # ให้รันด้วยตัวเองได้ด้วย

jobs:
   update-data:
     runs-on: ubuntu-latest
     steps:
       - name: Checkout repository
         uses: actions/checkout@v3

       - name: Set up Python
         uses: actions/setup-python@v4
         with:
           python-version: '3.x'

       - name: Install dependencies from requirements.txt
         run: |
           python -m pip install --upgrade pip
           if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
           
       - name: Run weather data scraper
         run: python Weather_data.py

       - name: Upload CSV to Firestore
         env:
             FIREBASE_CREDENTIALS: ${{ secrets.DB_SERVICE_ACCOUTKEY }}
         run: |
             echo "$DB_SERVICE_ACCOUTKEY" > firebase-key.json
             node upload-to-firestore.js
